<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Survivors Camp</title>
    </head>
    <body
        style="
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        "
    >
        <!-- Day/Time HUD -->
        <div id="timeHud" style="margin: 8px 0">
            <div style="align-items: center; margin-bottom: 4px">
                <span id="dayLabel">Day 1</span>
                <span id="tickLabel">0 / 100</span>
            </div>
            <div
                style="
                    width: 100%;
                    height: 10px;
                    background: #eee;
                    border-radius: 6px;
                    overflow: hidden;
                "
            >
                <div
                    id="timeBar"
                    style="height: 100%; width: 0%; background: #4caf50"
                ></div>
            </div>
            <!-- <div id="taskLabel" style="margin-top: 6px; opacity: 0.8">No task</div> -->
        </div>
        <script type="module">
            import GameClock from "./src/gameclock.js";
            import { updateTimeHud } from "./src/ui.js";
            import { createDefaultResourcesManager } from "./src/resources.js";
            import {
                createDefaultMorale,
                applyFireModifier,
            } from "./src/morale.js";

            const clock = GameClock();
            const resources = createDefaultResourcesManager();
            const morale = createDefaultMorale();

            // Keep morale modifier aligned with current fire state
            applyFireModifier(morale, resources.getState().fireOn);

            // HUD updates
            const offUI = clock.on("update", ({ state, config }) => {
                updateTimeHud({ state, config });
            });

            // Per-tick morale drain
            const offTick = clock.on("tick", ({ state, config }) => {
                morale.tick(1, config.DAY_TICKS);
            });

            // End-of-day resource processing; update morale fire modifier
            const offEnd = clock.on("endOfDay", () => {
                const summary = resources.applyEndOfDay();
                applyFireModifier(morale, summary.fireOn);
                // Basic console trace for now
                console.log("EOD:", {
                    resources: resources.getState(),
                    morale: morale.getState(clock.config.DAY_TICKS),
                    summary,
                });
            });

            clock.init();
        </script>
    </body>
</html>
